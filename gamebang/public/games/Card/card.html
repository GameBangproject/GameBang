<!DOCTYPE html>
<html>
<head>
  <title>카드 뒤집기 게임</title>
  <link rel="stylesheet" href="card.css">
</head>
<body>
  <div id="left">남은 개수: 10</div>
  <div id="count">시도 횟수: 0</div>
  <div id="game-container"></div>
  <button id="game_start" onclick="game_Start()">Game Start</button>
  

  <script>
    let x = 5; // 게임판 가로넓이
    let y = 4; // 게임판 세로넓이
    let openCard = [];
    let matchCard = [];
    let click = false;
    let count = 0;
    let left = 10;
    let back_color = [ // 카드 뒷면 색상
      'red', 'red,', 'yellow', 'yellow', 'green', 'green', 'blue', 'blue',
      'purple', 'purple', 'lightblue', 'lightblue', 'pink', 'pink', 'orange', 'orange',
      'aqua', 'aqua', 'brown', 'brown'
    ]
    let chooseColor = []; // 무작위로 받은 색상 저장 배열
    while (back_color.length > 0){ // 무작위 색상 뽑기
      let color = Math.floor(Math.random() * back_color.length);
      let mixedColor = back_color.splice(color, 1)[0];
      chooseColor.push(mixedColor);
    }

    function cardSetting(x, y) { // 카드 초기 세팅
      for (i = 0; i < x * y; i++){
        let card = document.createElement("div");
        card.className = 'card';
        card.id = chooseColor[i];
        let cardInner = document.createElement('div');
        cardInner.className = 'card_inner';
        let cardFront = document.createElement('div');
        cardFront.className = 'card_front';
        let cardBack = document.createElement('div');
        cardBack.className = 'card_back';
        cardBack.style.backgroundColor = chooseColor[i];
        cardInner.appendChild(cardFront);
        cardInner.appendChild(cardBack);
        card.append(cardInner);
        document.body.appendChild(card);
        
        card.addEventListener('click', function() { // 카드 뒤집는 이벤트 리스너
          if (click && !openCard.includes(card) && !matchCard.includes(card)){ // 클릭이 true이고 오픈 또는 매치된 카드가 아닌경우
            card.classList.toggle('flipped'); // class에 flipped 적용
            openCard.push(card); // openCard 배열에 추가
            if (openCard.length === 2){ // openCard 배열의 길이가 2인경우
              count++;
              document.getElementById('count').innerText = '시도 횟수: ' + count;
              if (openCard[0].querySelector('.card_back').style.backgroundColor === openCard[1].querySelector('.card_back').style.backgroundColor){ // 두 원소의 색상이 같으면
                left--;
                document.getElementById('left').innerText = '남은 개수: ' + left;
                matchCard.push(openCard[0]); // matchCard 배열에 추가
                matchCard.push(openCard[1]);
                openCard = []; // openCard 배열 초기화
                if (matchCard.length === 12){ // 게임을 클리어 한 경우
                  game_Clear();
                }
              }
              else{ // 두 원소의 색상이 다르면
                click = false; // 클릭 불가
                setTimeout(function (){
                  openCard[0].classList.remove('flipped'); // flipped class제거
                  openCard[1].classList.remove('flipped');
                  click = true; // 카드 클릭 가능
                  openCard = []; // 오픈된 카드 배열 초기화
                }, 1000);
              }
            }
          }
        })
      }
    }

    function game_Clear(){

    }

    function game_Start(){
      document.querySelectorAll('.card').forEach(function(card,index){
        setTimeout(function(){
          card.classList.add('flipped');
        }, 1000 + 200 * index);
      });

      setTimeout(function(){
        document.querySelectorAll('.card').forEach(function(card, index){
          card.classList.remove('flipped');
        });
        click = true;
      }, 8000);
    }

    function game_Clear() {
      alert("게임 클리어");
    }



    
    
    cardSetting(x, y);

  </script>
</body>
</html>
